# 이미지 최적화

## 1. 이미지의 중요성

- 현재 웹 페이지에 사용되는 이미지의 크기/수 증가 추세
- 화소 밀도: 물리 스크린안에 얼마나 많은 수의 픽셀 압축되어 있는가
  - 픽셀 수 많을수록 화소밀도 높고 화면 선명
  - 기기 픽셀 비율(1x, 2x,,,)로 표현: 단위 길이 안의 픽셀 수 상대적으로 나타내는 단위
  - PPI: 인치당 픽셀 개수
- 포인트: 웹 이미지 크기 표현하는 용어 중 하나
  - 40 픽셀 이미지 = 40픽셀 너비의 이미지 하나
  - 40 포인트 이미지 = 1x에선 40픽셀, 2x 80픽셀,,,너비의 이미지
- Hero 이미지(대문 이미지)
  - 늦게 로딩시 사용자의 불편
- 이미지는 웹 사이트의 기능, 성능 면에서 중요

## 2. 디지털 이미지의 종류와 특성

- 데스크톱 이미지 vs 모바일 이미지
  - PNG: 사용시 무게가 더 무거움, 알파채널 이미지 변환기법
    - !알파채널: 핵심 이미지 레이어 제외한 배경 이미지 레이어 제거해 전체 이미지 투명화 가능
    - 같은 품질의 JPEG보다 무거움
      > 투명 기능 불필요시 JPEG으로 변환
  - 사용목적, 기기에 맞는 이미지 선택 필요
- 레스터 이미지 vs 벡터 이미지
  - 래스터 이미지: 픽셀에 색상정보 입력해 컴퓨터로 표현
    - 확장성 부족: 사이즈 키우기위해 픽셀 추가 필요
  - 벡터 이미지: 대상의 수학적정보 제공 - 화면 크기에 상관없이 선명한 이미지 - 그림 복잡 시 수학적정보로 표현할 때 제약 - SVG파일: 텍스트 기반 콘텐츠
    > 래스터 이미지는 꾸준히 네트워크 전송용 이미지로 사용된 형식존재
- 무손실 이미지 형식 vs 손실 이미지 형식
  - 무손실 이미지
    - GIF: 색상 제한
    - PNG: 알파채널(투명기능)
  - 손실 이미지: JPEG & 브라우저 특화 이미지 유형
    - JPEG: 사진 저장 표준형식, 인식가능 외 색상제거
    - WebP: 점진적 전송 미지원
    - JPEG XR: 더많은 색상지원
    - JPEG 2000: 대부분의 브라우저에서 미지원

## 3. 이미지 변환 기법

- 무손실 압축
  - 스크립트 통해 압축 자동화가능
  - 라이브러리 통해 자동화
    - GIF
      - ImageMagicK
      - Giflossy
      - Gifsicle
      - git2webp converter: gif -> webp
    - PNG: 핵심청크외 사용자정의청크 삭제통한 이미지크기감소가능
      - Pngcrush
      - Pngquant
    - JPEG: 메타데이터(주석,,) 삭제통한 이미지크기감소가능
      - MozJPEG
      - libJpeg
      - Guetzli
- 손실 압축
  - 특정 이미지정보 누락, 손실시켜 파일크기 감소
  - JPEG품질: 100~75%\_ 품질저하 알기어렵&파일크기 효과적감소
  - 기존 이미지 디코딩 후 화질저하시켜 원래 이미지로 인코딩
    - ImageMagicK이 지원
      - `convert input.jpg -quality 80 output.jpg`
  - 적절한 손실 압축 품질 지수
    - UX저하 않고 이미지크기 감소
    - 최적 품질지수 찾기위해 수치화하는 알고리즘
      1. 평균제곱오차(MSE): 작을수록 유사
      2. 최대신호 대 잡음 비(PSNR): 클수록 유사
      3. 구조적유사도(SSIM): 1에 가까울수록 유사
      - 역구조적 유사도(DSSIM): 0에 가까울수록 유사
    - 화질같은 이미지여도 손실압축 라이브러리, 이미지형식따라 SSIM다름
  - 시각적 인지 능력을 고려한 자동 최적화 도구
    - 이미지화질\_ 원본이미지정보&사용자웹환경 고려필요(브라우저, 화면해상도,,,)
      - 클라이언트정보획득 -> SSIM결정 -> 화질수준계산 -> 변환
    - 자동최적화 기능 도구
      - CDN서비스 제공업체(Akamai...): 이미지 트래픽관련 자동최적화 기능
      - Cloudinary: 클라우드 상 이미지, 비디오 관리 솔루션
      - JPEGmini: 오프라인 최적화 도구(사용자환경고려 불가)
  - 브라우저 특화 이미지로 변환
    - 형태별 이미지 변환도구
      - WebP
        - `cwebp -q 80 image.png -o image.webp`
        - `webp image.webp -o image.png`
        - ImageMagicK
      - JPEG 2000
        - OpenJPEG
      - JPEG XR
        - jxrlib
