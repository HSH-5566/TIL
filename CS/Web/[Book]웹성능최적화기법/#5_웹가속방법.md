# 웹에서 가속을 이끌어내는 방법

## 1. 웹 브라우저 현황

- 웹 페이지 경량화&요청 수 줄여도 HTML을 화면에 그리는 것은 웹 브라우저
- => 프런트엔드 최적화의 핵심
  > 브라우저가 페이지를 화면에 렌더링하는 방식 이해&최적화
- 데스크톱 브라우저 점유율
  - 크롬 > Firefox > Safari > Edge Legacy > IE > Other
- 모바일 브라우저 점유율
  - 크롬 > Safari > Sansung Internet > UC Browser > Opera > Android > Firefox > Ohter
- 국내 데스크톱 브라우저 점유율
  - 크롬 > IE > Other
- 국내 모바일 브라우저 점유율
  - 크롬 > Samsung Internet > Safari > Other
    > 점유율 높은 브라우저에 대한 이미지 별도 준비하는 것이 효율적
- 국내 점유율이 높은 IE와 크롬에서 지원하는 이미지 형식, 폰트 타입 다르므로 주의
- 각 브라우저의 웹 페이지 전송, 렌더링 방식에는 큰 차이 없음
  - HTML해석해 이에 맞도록 객체 생성, 화면 크기에 맞춰 그림

## 2. 웹 브라우저 동작 이해하기

- 브라우저에서 웹 사이트 요청하는 순서: 브라우저에서 웹 사이트 주소이용해 서버에서 웹 페이지 다운하기까지의 흐름
  - IP찾기(DNS Resolving): 도메인 서버와 통신해 접속하려는 호스트의 IP찾음
  - TCP연결생성: 해당 IP의 서버와 통신해 TCP연결(HTTPS의 경우 암호화 연결생성위한 협의 단계 추가)
  - 리소스 다운로드: 연결완료 후 브라우저가 서버에서 필요한 리소스 다운해 화면에 표현
    - 방문 페이지의 HTML을 서버에 요청해 다운
    - HTML 구문을 분석(parsing)하며 하위 리소스 차례로 다운(HTML 태그에 참조된 CSS, JS image, font,,)
- 브라우저 아키텍처: 브라우저는 크게 7개의 컴포넌트로 구성
  - 유저 인터페이스: 사용다가 브라우저 통해 상호작용 가능하게 함
  - 브라우저 엔진: 유저 인터페이스-렌더링엔진 사이에서 렌더링 상태 조회, 렌더링 작업 제어위한 인터페이스 제공
  - 렌더링 엔진: 실제 웹 콘텐츠를 브라우저창에 그림(HTML분석해 표현, CSS분석해 웹 페이지 꾸밈)
    > 실제로 HTML 처리해 화면에 렌더링 하는 컴포넌트
    - ex) Webkit(safari), Gecko(firefox), Blink(크롬), Trident(IE) 렌더링 엔진
  - 네트워킹: 네트워크 통해 HTTP요청&응답 받음(DNS조회, TCP연결)
  - UI 백엔드: 콤보박스, 드롭박스,,, 기본적인 UI 컴포넌트 제공
  - 자바스크립트 해석기: JS 분석&해석(V8, Spider Monkey)
  - 데이터 저장소: 데이터 지속성 유지(쿠키, localStorage, indexDB)
- 중요 렌더링 경로
  - 렌더링 엔진의 작업은 선후관계 명확해 단일 스레드의해 수행
    - HTML해석안되면 CSS,JS수행불가, 객체모델 미생성시 브라우저의 화면구성 불가,,
  - 브라우저의 중요 렌더링 경로(Critical Rendering Path)
    1. 브라우저는 처음으로 HTML 구문분석해 DOM 트리 생성
    2. CSS 구문분석해 CSSOM 트리 생성
    3. 두 트리모델 결합해 최종적으로 렌더트리 생성
    4. 브라우저가 렌더트리 기반으로 페이지구조 결정&화면에 표현
  - DOM 트리 생성
    - 브라우저가 가장 먼저 다운한HTML 구문 분석해 태그 하나하나 해석하여 DOM 객체모델로 변환
      - 마크업언어: HTML, XML, 사람 가독성 좋으나 컴퓨터가 이용하기 어려움
      - !DOM: 객체지향적 프로그래밍 언어들로 마크업 문서를 쉽게 프로그래밍 하기위해 표준으로 규정한 프로그램 인터페이스 / 객체 속성, 메소드, 이벤트 등을 정의
  - CSSOM 트리 생성
    - 브라우저가 HTML 구문분석하며 CSS 참조링크 만날 시 해당 CSS 리소스 다운후 구문 분석기가 CSS 분석
    - HTML구문분석과정이 CSS분석에 방해받지 않음: HTML과 다르게 엄격한 구문검사, 구문 분석방법 달라 사용하는 구문 분석기, 동작 스레드 다름
    - !CSSOM: CSS 처리위한 트리구조의 프로그래밍 인터페이스
  - 렌더 트리생성
    - DOM트리와 CSSOM트리 구문 분석완료 시 브라우저가 두 트리 병합
    - !렌더트리: DOM, CSSOM 기반으로 렌더링 위한 최종정보 가진 렌더 객체 생성해 상하관계 트리모양으로 구성
  - 레이아웃
    - 렌더 트리 노드들의 위치 정보 계산
      - 렌더 객체는 사각형 영역 표시 -> 브라우저 창 맨 왼쪽위~아래, 오른쪽으로 이동하며 각 사각형 영역의 너비, 높이 계산
      - 루트노드의 너비: 뷰 포트의 크기
      - 부모 노드의 너비따라 자식 노드 너비 계산, 재귀적
      - 자식 노드의 높이따라 부모 노드 높이 계산, 재귀적
  - 페인트
    - 렌더 트리 정보 바탕으로 브라우저 창에 표현
    - 렌더링위한 정보 모두 존재하므로 GPU이용해 그리면 됨
  - > JS의 경우 DOM, CSSOM 동적으로 변경 가능
    - 변경시 렌더트리 변경&레이아웃, 페인트 재수행
    - JS방해 없이 렌더링 최적화하는 방법 필요
